<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BilPro Y√∂netim - Clean V1</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <style>
        :root { --p: #238636; --bg: #0d1117; --card: rgba(22, 27, 34, 0.95); --text: #f0f6fc; --border: #30363d; }
        body.light-mode { --bg: #f6f8fa; --card: #ffffff; --text: #24292f; --border: #d0d7de; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; transition: 0.3s; overflow-x: hidden; }

        .full-screen { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; background: #0d1117; z-index: 5000; position: fixed; inset: 0; }
        .box { background: #161b22; padding: 40px; border-radius: 20px; border: 1px solid #30363d; width: 340px; text-align: center; }
        input { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg); color: white; box-sizing: border-box; }

        header { background: var(--card); backdrop-filter: blur(10px); height: 70px; display: flex; align-items: center; justify-content: space-between; padding: 0 30px; border-bottom: 2px solid var(--p); position: sticky; top: 0; z-index: 1000; }
        .container { padding: 30px; max-width: 1400px; margin: auto; }
        .personel-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; }
        .card { background: var(--card); border-radius: 15px; border: 1px solid var(--border); overflow: hidden; transition: 0.3s; cursor: pointer; text-align: center; }
        .card img { width: 100%; height: 260px; object-fit: cover; }

        button { padding: 12px; border-radius: 8px; font-weight: 600; cursor: pointer; border: none; transition: 0.2s; }
        .btn-p { background: var(--p); color: white; width: 100%; }
        .btn-outline { background: transparent; border: 1px solid var(--p); color: var(--p); }
        
        .sidebar { position: fixed; right: -380px; top: 0; width: 340px; height: 100vh; background: var(--card); border-left: 2px solid var(--p); transition: 0.4s ease; padding: 30px; z-index: 2000; box-sizing: border-box; overflow-y: auto; }
        .sidebar.active { right: 0; }
        .sidebar-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; z-index: 1500; }
        .sidebar-overlay.active { display: block; }
        
        .theme-dot { height: 32px; width: 32px; border-radius: 50%; cursor: pointer; border: 2px solid var(--border); }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 6000; justify-content: center; align-items: center; padding: 20px; }
        .modal-content { background: var(--card); padding: 30px; border-radius: 20px; width: 100%; max-width: 400px; border: 2px solid var(--p); max-height: 90vh; overflow-y: auto; }
        
        .mesai-box { background: rgba(0,0,0,0.2); padding: 20px; border-radius: 15px; text-align: center; margin: 15px 0; border: 1px solid var(--p); }
        .mesai-box span { display: block; font-size: 2.8rem; font-weight: 900; color: var(--p); }

        .hidden { display: none !important; }
        .logo-img { height: 40px; margin-right: 15px; border-radius: 5px; }
    </style>
</head>
<body>

<div id="overlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>

<div id="auth-screen" class="full-screen">
    <div class="box">
        <h1 style="color:white; margin-bottom:20px;">BilPro <span style="color:var(--p)">Sistem</span></h1>
        <input type="email" id="fb-email" placeholder="E-posta">
        <input type="password" id="fb-pass" placeholder="≈ûifre">
        <button class="btn-p" onclick="loginFirebase()">Giri≈ü</button>
        <p id="auth-error" style="color:#da3633; font-size:11px; margin-top:10px;"></p>
    </div>
</div>

<div id="choice-screen" class="full-screen hidden">
    <h2 id="txt-welcome" style="color:white; margin-bottom:30px;">Ho≈ü Geldiniz</h2>
    <div style="display:flex; gap:15px;">
        <button class="btn-outline" style="width:160px; height:120px;" onclick="enterApp('user')"><div style="font-size:2rem">üë§</div><span id="txt-user-btn">Personel</span></button>
        <button class="btn-p" style="width:160px; height:120px;" onclick="enterApp('admin')"><div style="font-size:2rem">üîë</div><span id="txt-admin-btn">Y√∂netici</span></button>
    </div>
</div>

<div id="main-app" class="hidden">
    <header>
        <div style="display:flex; align-items:center;">
            <button onclick="goChoice()" class="btn-outline" id="btn-home" style="padding: 5px 12px; font-size: 11px; margin-right: 15px;">üè† Men√º</button>
            <img id="view-logo" class="logo-img hidden">
            <span id="compName" style="font-weight:700;"></span>
        </div>
        <button onclick="toggleSidebar()" style="background:none; color:var(--p); font-size:28px;">‚ò∞</button>
    </header>

    <div class="container">
        <div id="grid" class="personel-grid"></div>
        <div id="empty-msg" style="text-align:center; margin-top:100px; opacity:0.3; display:none;">
            <h3>Hen√ºz personel eklenmemi≈ü.</h3>
        </div>
    </div>

    <div id="sidebar" class="sidebar">
        <h3 id="txt-settings">Ayarlar</h3>
        <button onclick="toggleLang()" class="btn-outline" style="width:100%; margin-bottom:10px;">üåç <span id="cur-lang">TR / EN</span></button>
        <button onclick="toggleMode()" class="btn-outline" style="width:100%; margin-bottom:15px;">üåì <span id="txt-theme-mode">Tema</span></button>
        <div id="themeGrid" style="display:grid; grid-template-columns:repeat(4,1fr); gap:8px; margin-bottom:20px;"></div>

        <div id="admin-tools" class="hidden">
            <hr style="border-top:1px solid var(--border); margin-bottom:15px;">
            <input type="text" id="setCompName" placeholder="≈ûirket ƒ∞smi">
            <label style="font-size:11px;">Logo:</label>
            <input type="file" id="logoUpload" accept="image/*" style="font-size:10px;">
            <button class="btn-p" onclick="updateCompany()" id="btn-comp-save">Kaydet</button>
            <br><br>
            <input type="text" id="newName" placeholder="Yeni Personel Adƒ±">
            <input type="text" id="newJob" placeholder="G√∂revi">
            <input type="file" id="newPhoto" accept="image/*" style="font-size:10px;">
            <button class="btn-p" onclick="addPersonel()" id="btn-add">Personel Ekle</button>
            
            <button class="btn-p" style="background:#da3633; margin-top:30px;" onclick="logoutFirebase()" id="btn-exit">üî¥ G√úVENLƒ∞ √áIKI≈û</button>
        </div>
    </div>
</div>

<div id="pModal" class="modal">
    <div class="modal-content">
        <div style="text-align:center;">
            <img id="modal-img" style="width:110px; height:110px; border-radius:50%; object-fit:cover; border:3px solid var(--p); margin-bottom:10px;">
            <h2 id="modal-name" style="margin:0;"></h2>
            <p id="modal-job" style="opacity:0.6; margin-top:5px;"></p>
        </div>

        <div class="mesai-box">
            <small id="txt-monthly-label" style="font-weight:bold; opacity:0.8;">BU AY YAPILAN TOPLAM MESAƒ∞</small>
            <span id="mTotal">0</span>
        </div>

        <div id="admin-entry" class="hidden">
            <hr style="margin:20px 0;">
            <input type="number" id="wHours" placeholder="Saat Miktarƒ±">
            <input type="date" id="wDate">
            <button class="btn-p" onclick="saveWork()" id="btn-work-save">Mesai Ekle</button>
            <button class="btn-p" onclick="resetWork()" style="background:#da3633; margin-top:10px; font-size:11px;">‚ö†Ô∏è MESAƒ∞LERƒ∞ SIFIRLA</button>
            <hr style="margin:20px 0;">
            <input type="text" id="editName" placeholder="ƒ∞sim">
            <input type="text" id="editJob" placeholder="G√∂rev">
            <input type="file" id="editPhoto" accept="image/*" style="font-size:10px;">
            <button class="btn-p" onclick="saveEdit()" id="btn-edit-save" style="background:gray;">Bilgileri G√ºncelle</button>
        </div>

        <button onclick="closeModal()" class="btn-outline" style="width:100%; margin-top:15px;" id="btn-close">Kapat</button>
    </div>
</div>

<script>
    const langData = {
        tr: { user: "Personel", admin: "Y√∂netici", home: "üè† Men√º", settings: "Ayarlar", themeMode: "Tema", compSave: "Kaydet", add: "Personel Ekle", exit: "üî¥ G√úVENLƒ∞ √áIKI≈û", monthlyLabel: "BU AY YAPILAN TOPLAM MESAƒ∞", close: "Kapat", workSave: "Mesai Ekle", editSave: "G√ºncelle" },
        en: { user: "Staff", admin: "Admin", home: "üè† Menu", settings: "Settings", themeMode: "Theme", compSave: "Save", add: "Add Staff", exit: "üî¥ SECURE LOGOUT", monthlyLabel: "MONTHLY OVERTIME TOTAL", close: "Close", workSave: "Add Work", editSave: "Update Info" }
    };

    const firebaseConfig = {
        apiKey: "AIzaSyAYDrXOMlxsHEP3NiwcMMlNyESBOjcMU-0",
        authDomain: "panel-20a4e.firebaseapp.com",
        databaseURL: "https://panel-20a4e-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "panel-20a4e",
        storageBucket: "panel-20a4e.firebasestorage.app",
        messagingSenderId: "453171272261",
        appId: "1:453171272261:web:85ac93746d105b4add612c",
        measurementId: "G-X5JDRSBQCZ"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    function loginFirebase() {
        const e = document.getElementById('fb-email').value, p = document.getElementById('fb-pass').value;
        auth.signInWithEmailAndPassword(e, p).catch(err => document.getElementById('auth-error').innerText = err.message);
    }
    function logoutFirebase() { auth.signOut().then(() => location.reload()); }
    auth.onAuthStateChanged(user => {
        if(user) { document.getElementById('auth-screen').classList.add('hidden'); document.getElementById('choice-screen').classList.remove('hidden'); }
        else { document.getElementById('auth-screen').classList.remove('hidden'); }
    });

    // SIFIR VERƒ∞ YAPISI
    let personeller = JSON.parse(localStorage.getItem('pData')) || [];
    let config = JSON.parse(localStorage.getItem('cData')) || { name: "≈ûirket ƒ∞smi Giriniz", logo: "", theme: "#238636", mode: 'dark', lang: 'tr' };
    let activeMode = 'user', selectedP = null;

    function updateUI() {
        const t = langData[config.lang];
        document.body.className = config.mode + "-mode";
        document.documentElement.style.setProperty('--p', config.theme);
        document.getElementById('compName').innerText = config.name;
        
        if(config.logo) { 
            document.getElementById('view-logo').src = config.logo; 
            document.getElementById('view-logo').classList.remove('hidden'); 
        } else {
            document.getElementById('view-logo').classList.add('hidden');
        }
        
        document.getElementById('txt-user-btn').innerText = t.user;
        document.getElementById('txt-admin-btn').innerText = t.admin;
        document.getElementById('btn-home').innerText = t.home;
        document.getElementById('txt-settings').innerText = t.settings;
        document.getElementById('txt-theme-mode').innerText = t.themeMode;
        document.getElementById('btn-comp-save').innerText = t.compSave;
        document.getElementById('btn-add').innerText = t.add;
        document.getElementById('btn-exit').innerText = t.exit;
        document.getElementById('txt-monthly-label').innerText = t.monthlyLabel;
        document.getElementById('btn-close').innerText = t.close;
        document.getElementById('btn-work-save').innerText = t.workSave;
        document.getElementById('btn-edit-save').innerText = t.editSave;

        const colors = ['#238636','#1f6feb','#8957e5','#da3633','#d29922', '#808080', '#4b5563', '#ffffff'];
        document.getElementById('themeGrid').innerHTML = colors.map(c => `<div class="theme-dot" style="background:${c}; ${config.theme===c?'border:2px solid white':''}" onclick="setTheme('${c}')"></div>`).join('');

        const grid = document.getElementById('grid');
        if(personeller.length === 0) {
            document.getElementById('empty-msg').style.display = 'block';
            grid.innerHTML = "";
        } else {
            document.getElementById('empty-msg').style.display = 'none';
            grid.innerHTML = personeller.map(p => `
                <div class="card" onclick="openP(${p.id})">
                    <img src="${p.img || 'https://via.placeholder.com/300x400?text=Fotoƒüraf+Yok'}">
                    <div style="padding:15px;">
                        <h4 style="margin:0;">${p.name}</h4>
                        <small style="color:gray;">${p.job}</small>
                        ${activeMode==='admin' ? `<div style="margin-top:10px;"><button onclick="event.stopPropagation(); deleteP(${p.id})" style="color:#da3633; background:none; font-size:10px;">‚ùå Sƒ∞L</button></div>` : ''}
                    </div>
                </div>`).join('');
        }
    }

    function enterApp(mode) {
        if(mode === 'admin') {
            if(prompt("Y√∂netici ≈ûifresi:") !== "147258*") return;
            activeMode = 'admin';
            document.getElementById('admin-tools').classList.remove('hidden');
            document.getElementById('admin-entry').classList.remove('hidden');
        } else {
            activeMode = 'user';
            document.getElementById('admin-tools').classList.add('hidden');
            document.getElementById('admin-entry').classList.add('hidden');
        }
        document.getElementById('choice-screen').classList.add('hidden');
        document.getElementById('main-app').classList.remove('hidden');
        updateUI();
    }

    function openP(id) {
        selectedP = personeller.find(x => x.id === id);
        document.getElementById('modal-img').src = selectedP.img || 'https://via.placeholder.com/100?text=N/A';
        document.getElementById('modal-name').innerText = selectedP.name;
        document.getElementById('modal-job').innerText = selectedP.job;
        document.getElementById('editName').value = selectedP.name;
        document.getElementById('editJob').value = selectedP.job;
        calcMonthly();
        document.getElementById('pModal').style.display = 'flex';
    }

    function calcMonthly() {
        const startOfMonth = new Date(new Date().getFullYear(), new Date().getMonth(), 1);
        const logs = selectedP.log || [];
        const monthly = logs.filter(l => new Date(l.d) >= startOfMonth).reduce((s, l) => s + l.h, 0);
        document.getElementById('mTotal').innerText = monthly;
    }

    function resetWork() {
        if(confirm("Mesai ge√ßmi≈üini temizlemek istiyor musunuz?")) {
            selectedP.log = []; save(); calcMonthly();
        }
    }

    function saveWork() {
        const h = parseFloat(document.getElementById('wHours').value), d = document.getElementById('wDate').value;
        if(h && d) { if(!selectedP.log) selectedP.log = []; selectedP.log.push({h, d}); save(); calcMonthly(); }
    }

    function saveEdit() {
        selectedP.name = document.getElementById('editName').value;
        selectedP.job = document.getElementById('editJob').value;
        const f = document.getElementById('editPhoto').files[0];
        if(f) {
            const r = new FileReader();
            r.onload = (e) => { selectedP.img = e.target.result; save(); updateUI(); closeModal(); };
            r.readAsDataURL(f);
        } else { save(); updateUI(); closeModal(); }
    }

    function updateCompany() {
        config.name = document.getElementById('setCompName').value || config.name;
        const file = document.getElementById('logoUpload').files[0];
        if(file) {
            const r = new FileReader();
            r.onload = (e) => { config.logo = e.target.result; save(); updateUI(); };
            r.readAsDataURL(file);
        } else { save(); updateUI(); }
    }

    function addPersonel() {
        const n = document.getElementById('newName').value, j = document.getElementById('newJob').value, f = document.getElementById('newPhoto').files[0];
        if(!n) return;
        const process = (imgData = "") => {
            personeller.push({id:Date.now(), name:n, job:j, img:imgData, log:[]});
            save(); updateUI();
            document.getElementById('newName').value = "";
            document.getElementById('newJob').value = "";
        };
        if(f) { const r = new FileReader(); r.onload = (e) => process(e.target.result); r.readAsDataURL(f); }
        else process();
    }

    function save() { localStorage.setItem('pData', JSON.stringify(personeller)); localStorage.setItem('cData', JSON.stringify(config)); }
    function goChoice() { document.getElementById('main-app').classList.add('hidden'); document.getElementById('choice-screen').classList.remove('hidden'); }
    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); document.getElementById('overlay').classList.toggle('active'); }
    function toggleMode() { config.mode = config.mode === 'dark' ? 'light' : 'dark'; save(); updateUI(); }
    function toggleLang() { config.lang = config.lang === 'tr' ? 'en' : 'tr'; save(); updateUI(); }
    function setTheme(c) { config.theme = c; save(); updateUI(); }
    function closeModal() { document.getElementById('pModal').style.display = 'none'; }
    function deleteP(id) { if(confirm("Personel silinsin mi?")) { personeller = personeller.filter(p => p.id !== id); save(); updateUI(); } }

    updateUI();
</script>
</body>
</html>